<!DOCTYPE html>
<html>
  <head>
      <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
      <script src="https://cdn.jsdelivr.net/gh/c-frame/physx@latest/dist/physx.min.js"></script>
      <script src="../../components/bricks/index.js"></script>
      <script src="./colors.js"></script>
      <script>
        const BRICK_WIDTH = 4
        const BRICK_DEPTH = 2
        const BRICK_HEIGHT = 3
        AFRAME.registerComponent('brick-wall', {
          schema: {
            width: {default: 3},
            height: {default: 3},
          },
          init() {

            for (let ii = 0; ii < this.data.width; ii++) {

              const y = (ii + 1) * BRICK_HEIGHT * PLATE_HEIGHT
              
              for (let jj = 0; jj < this.data.width; jj++) {

                const offset = (ii % 2) /2
                const x = (jj + offset - (this.data.width / 2)) * UNIT_WIDTH * BRICK_WIDTH

                const brick = this.createBrick(x, y, 0)

                this.bindToBase(brick) 

              }
            }
          },

          createBrick(x, y, z) {

            const randomMember = (array) => {
              const index = Math.floor(Math.random() * array.length)
              return array[index]
            }

            const color = randomMember(COLORS)

            const brick = document.createElement('a-brick')
            brick.setAttribute("width", BRICK_WIDTH)
            brick.setAttribute("height", BRICK_HEIGHT)
            brick.setAttribute("depth", BRICK_DEPTH)
            brick.setAttribute("color", color)
            brick.setAttribute("position", {x, y, z})

            this.el.appendChild(brick)

            return brick
          },

          bindToBase(brick) {

            /*for (let ii = 0; ii < BRICK_WIDTH; ii++) {
              for (let jj = 0; jj < BRICK_WIDTH; jj++) {

                const x = ((ii - BRICK_WIDTH) / 2) * UNIT_WIDTH
                const z = ((jj - BRICK_WIDTH) / 2) * UNIT_WIDTH
                this.createJoint(brick, '#base', x, z)
              }
            }*/
            this.createJoint(brick, '#base', 0, 0)
          },

          createJoint(brick, targetId, x, z) {

            const joint = document.createElement('a-entity');
            const y = -BRICK_HEIGHT * PLATE_HEIGHT / 2
            joint.object3D.position.set(x, y, z)
            joint.setAttribute('physx-joint', {type: "Fixed", target: targetId})
            brick.appendChild(joint)
          }
        })
      </script>
      <link rel="stylesheet" href="../styles.css">
  </head>
  <body>
    <!--<div class="text-overlay">
        <p>Building with bricks</p>
    </div>-->
        <a class="code-link"
        target="_blank"
        href="https://github.com/diarmidmackenzie/aframe-components/blob/main/component-usage/bricks.html">
        view code
    </a>
      <a-scene background="color:#88f" stats
               physx="autoLoad: true; delay: 1000; useDefaultScene: false; stats: panel">
        <a-entity position = "0 1 -3" scale="0.01 0.01 0.01" brick-wall>
            <a-brick id="base" width="60" movement="static" depth="60" height="3" color="#4B9F4A" position="0 0 0">
            </a-brick>
        </a-entity>
      </a-scene>
  </body>
</html>



