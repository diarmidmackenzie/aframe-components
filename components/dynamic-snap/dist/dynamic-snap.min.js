(()=>{var e={12:()=>{AFRAME.registerComponent("polygon-wireframe",{schema:{color:{type:"color",default:"grey"},dashed:{type:"boolean",default:!1},dashSize:{type:"number",default:3},gapSize:{type:"number",default:1},dashScale:{type:"number",default:30},onTop:{type:"boolean",default:!1}},init(){const e=this.el.getObject3D("mesh").geometry;e||console.warn("polygon-wireframe: no base geometry found"),this.edges=new THREE.EdgesGeometry(e)},update(){const e=this.material,t=this.line;if(this.data.dashed?this.material=new THREE.LineDashedMaterial({color:this.data.color,dashSize:this.data.dashSize,gapSize:this.data.gapSize,scale:this.data.dashScale}):this.material=new THREE.LineBasicMaterial({color:this.data.color}),this.data.onTop){const e=this.material;e.depthWrite=!1,e.depthTest=!1,e.toneMapped=!1,e.transparent=!0}this.line=new THREE.LineSegments(this.edges,this.material),this.line.computeLineDistances(),this.el.object3D.add(this.line),this.el.getObject3D("mesh").visible=!1,t&&t.removeFromParent(),e&&e.dispose()},remove(){this.el.getObject3D("mesh").visible=!0,this.material.dispose(),this.line.removeFromParent()}})}},t={};(function i(s){var a=t[s];if(void 0!==a)return a.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,i),r.exports})(12),AFRAME.registerComponent("dynamic-snap",{schema:{divergeEvent:{type:"string",default:"mouseGrab"},convergeEvent:{type:"string",default:"mouseRelease"},renderSnap:{type:"string",oneOf:["object","wireframe","transparent","none"],default:"object"},renderPrecise:{type:"string",oneOf:["object","wireframe","transparent","none"],default:"transparent"},wireframeColor:{default:"yellow"},opacity:{default:.5}},init(){this.snapStart=this.snapStart.bind(this),this.snapEnd=this.snapEnd.bind(this),this.diverge=this.diverge.bind(this),this.converge=this.converge.bind(this),this.configureThisEl("object"),this.projectedEl=document.createElement("a-entity"),this.configureProjectedEl(),this.el.sceneEl.appendChild(this.projectedEl),this.snappable=!1,this.diverged=!1,this.hideProjectedObject()},configureProjectedEl(){const e=this.el.getObject3D("mesh");if(e){const t=e.clone(!0);this.projectedEl.setObject3D("mesh",t),this.setMaterials(this.projectedEl,t,this.data.renderSnap)}else this.el.addEventListener("model-loaded",(()=>this.configureProjectedEl()))},configureThisEl(e){const t=this.el.getObject3D("mesh");t?this.setMaterials(this.el,t,e):this.el.addEventListener("model-loaded",(()=>{this.configureThisEl(e)}))},setMaterials(e,t,i){const s=(e,t)=>{const i=e.material;if(!i)return;const s=i.userData.type;if(s)"original"===s?t&&(e.material=i.userData.transparentClone):"transparentClone"===s&&(t||(e.material=i.userData.original));else{i.userData.type="original";const e=i.clone();e.opacity=this.data.opacity,e.transparent=!0,e.userData.type="transparentClone",e.userData.original=i,i.userData.transparentClone=e}};"wireframe"===i?e.setAttribute("polygon-wireframe",{color:this.data.wireframeColor,onTop:!0}):e.removeAttribute("polygon-wireframe"),"transparent"===i?t.traverse((e=>{s(e,!0)})):t.traverse((e=>{s(e,!1)})),t.visible="none"!==i&&"wireframe"!==i},addEventListeners(){this.el.addEventListener("snapStart",this.snapStart),this.el.addEventListener("snapEnd",this.snapEnd),this.el.addEventListener(this.data.divergeEvent,this.diverge),this.el.addEventListener(this.data.convergeEvent,this.converge)},removeEventListeners(){this.el.removeEventListener("snapStart",this.snapStart),this.el.removeEventListener("snapEnd",this.snapEnd),this.el.removeEventListener(this.data.divergeEvent,this.diverge),this.el.removeEventListener(this.data.convergeEvent,this.converge)},pause(){this.removeEventListeners()},play(){this.addEventListeners()},snapStart(e){this.snappable=!0,this.diverged&&this.showProjectedObject(e.detail.worldTransform)},snapEnd(e){e.detail.transform,this.snappable=!1},showProjectedObject(e){const t=this.projectedEl.object3D;t.position.copy(e.position),t.quaternion.copy(e.quaternion),t.scale.copy(e.scale),t.visible=!0,this.configureThisEl(this.data.renderPrecise)},hideProjectedObject(){this.projectedEl.object3D.visible=!1,this.configureThisEl("object")},diverge(){this.diverged=!0,this.snappable&&this.showProjectedObject(this.projectedEl.object3D)},converge(){if(this.snappable){const e=this.el.object3D,t=e.parent,i=this.projectedEl.object3D;e.matrix.identity(),e.matrix.decompose(e.position,e.quaternion,e.scale),i.add(e),t.attach(e),this.hideProjectedObject()}this.diverged=!1}})})();